# Flow Calendar - Анализ приложения

Дата анализа: 25 января 2026

## Обзор приложения

**Flow Calendar** — это минималистичный планировщик задач с Fluent-дизайном, который группирует день на естественные временные блоки (Утро, День, Вечер) для гибкого и свободного от стресса планирования.

| Характеристика | Значение |
|----------------|----------|
| **Название** | EXPORT Flow Calendar |
| **Версия** | 0.0.0 |
| **Тип** | Web-приложение (React) |
| **Языки интерфейса** | Английский, Русский, Испанский |

---

## Технологический стек

### Frontend
- **React 19.2.3** — UI библиотека с использованием React 19
- **TypeScript 5.8.2** — типизация
- **Vite 6.2.0** — сборщик модулей
- **Tailwind CSS** — утилитарные CSS классы (через CDN)
- **Lucide React 0.562.0** — иконки

### AI/ML
- **Google GenAI 1.38.0** — интеграция с Gemini AI для интеллектуальной классификации задач

### Инструменты разработки
- **@vitejs/plugin-react 5.0.0** — React плагин для Vite
- **@types/node 22.14.0** — типы Node.js

---

## Архитектура проекта

```
flow-calendar/
├── App.tsx              # Главный компонент приложения (~663 строки)
├── constants.tsx        # Константы, переводы, конфигурации
├── types.ts             # TypeScript типы и интерфейсы
├── main.tsx             # Точка входа приложения
├── index.html           # HTML шаблон
├── components/
│   ├── Auth.tsx         # Компонент аутентификации
│   └── TaskItem.tsx     # Компонент элемента задачи
└── services/
    └── geminiService.ts # Сервис интеграции с Gemini AI
```

---

## Основные возможности

### 1. Управление временем (Time Blocking)

Приложение делит день на 4 временных периода:

| Период | Описание |
|--------|----------|
| **Morning** (Утро) | Блок для утренних задач |
| **Afternoon** (День) | Блок для дневных задач |
| **Evening** (Вечер) | Блок для вечерних задач |
| **Night** (Ночь) | Период отдыха |

Динамический расчёт временных блоков на основе настроек:
- `wakeUpTime` — время пробуждения
- `restTime` — время отдыха

### 2. Система задач

**Поля задачи:**
- `id` — уникальный идентификатор
- `title` — название задачи
- `periods[]` — временные периоды (может быть несколько)
- `completed` — статус выполнения
- `createdAt` — дата создания
- `priority` — приоритет (low/medium/high)
- `weight` — вес/сложность задачи
- `notes` — заметки (опционально)
- `dueDate` — срок выполнения
- `recurrence` — повторяемость

**Типы веса задач (Weight):**

| Вес | Очки | Иконка | Цвет | Описание |
|-----|------|--------|------|----------|
| Quick | 1 | Zap | #107c10 | Простые задачи (< 15 мин) |
| Focused | 3 | Target | #0078d4 | Стандартные задачи (30-60 мин) |
| Deep | 6 | Layers | #5c2d91 | Интенсивные задачи (2+ часа) |

**Лимит вместимости блока:** 12 очков (определяется константой `BLOCK_CAPACITY`)

### 3. Повторяемость задач

Поддерживаемые типы повторения:
- `none` — один раз
- `daily` — ежедневно
- `weekly` — еженедельно
- `monthly` — ежемесячно
- `all-blocks` — 3 раза в день (во все блоки)

### 4. Просмотры календаря

| Режим | Описание |
|-------|----------|
| **Day** | Посмотр задач на конкретный день с разбивкой по блокам |
| **Week** | Недельный вид с горизонтальной прокруткой |
| **Month** | Месячный календарь с точками-индикаторами задач |
| **Year** | Годовой обзор с мини-календарями по месяцам |

### 5. AI-функциональность (Gemini)

**Интеграция с Google Gemini AI:**

1. **Автоматическая классификация веса задачи**
   - При вводе названия задачи (>3 символов)
   - Задержка 1 секунда перед запросом
   - Классификация на QUICK/FOCUSED/DEEP
   - Тихий fallback при ошибках

2. **Оптимизация порядка задач**
   - Функция `optimizeTasks()` (описана в коде, но не используется в UI)
   - Анализ приоритетов и веса задач
   - Рекомендация логического порядка выполнения

### 6. Будильник

**Возможности:**
- Настройка времени будильника
- 7 звуков природы (forest, sea, water, birds, rain, wind, zen)
- Плавное увеличение громкости (15 секунд fade-in)
- Функция "Snooze" (+5 минут)
- Визуальный интерфейс срабатывания будильника

### 7. Режим восстановления (Recovery Mode)

**Условия активации:**
- Designated recovery days (выходные по умолчанию: воскресенье, суббота)
- Wind-down период (за 90 минут до времени отдыха)

**Функции:**
- Показ мотивационных советов по восстановлению
- Визуальные индикаторы режима (фиолетовая/изумрудная цветовая схема)

### 8. Аутентификация

**Типы входа:**
- Google OAuth (симуляция)
- Email/Password (симуляция)
- Guest mode (без регистрации)

**Хранение данных:**
- `localStorage` для задач (`flow_tasks`)
- `localStorage` для настроек (`flow_settings`)
- `localStorage` для пользователя (`flow_user`)

---

## Настройки пользователя

**Доступные настройки:**

| Параметр | Тип | Описание |
|----------|-----|----------|
| `wakeUpTime` | string (HH:mm) | Время пробуждения |
| `restTime` | string (HH:mm) | Время отдыха/сна |
| `recoveryDays` | number[] | Дни восстановления [0-6] |
| `workHistory` | string[] | История выполненных задач |
| `language` | 'en'\|'ru'\|'es' | Язык интерфейса |
| `alarm.enabled` | boolean | Включён ли будильник |
| `alarm.time` | string (HH:mm) | Время будильника |
| `alarm.sound` | string | Звук будильника |

**Валидация:**
- Минимальный перерыв между `wakeUpTime` и `restTime` — 7 часов (420 минут)

---

## Мультиязычность

Поддерживаемые языки:
- **English** (en)
- **Русский** (ru)
- **Español** (es)

Переводы хранятся в `constants.tsx` в объекте `TRANSLATIONS`.

---

## UI/UX особенности

### Дизайн
- **Glassmorphism** — размытый фон с прозрачностью
- **Fluent Design** — плавные анимации и переходы
- **Gradient backgrounds** — анимированные фоновые пятна
- **Color coding** — цветовая индикация приоритетов и веса

### Анимации
- Плавные переходы между экранами
- Анимация появления элементов (`fade-in`, `slide-in`)
- Pulse анимация для активных элементов
- Swing анимация для будильника

### Адаптивность
- Mobile-first подход
- Максимальная ширина контейнера: `max-w-lg`
- Touch-friendly targets (минимум 44px)
- Горизонтальная прокрутка для недельного вида

---

## Экраны приложения

### 1. Splash Screen
- Логотип с анимацией вращения
- Задержка 3 секунды
- Переход к auth или ready

### 2. Auth Screen
- Формы входа и регистрации
- Кнопка "Continue with Google"
- Опция "Continue as Guest"
- Валидация email и password

### 3. Main Screen
- **Header**: Приветствие, дата, кнопки настроек/будильника
- **View Switcher**: Day/Week/Month/Year
- **Date Navigator**: Навигация по датам
- **Recovery Banner**: Индикатор режима восстановления
- **Task Form**: Добавление новых задач
- **Time Blocks**: Карточки временных блоков с задачами

### 4. Alarm Screen
- Полноэкранный интерфейс при срабатывании
- Мотивационный совет
- Кнопки "Enter Thread" и "Snooze"

### 5. Settings Modal
- Настройка времени пробуждения и отдыха
- Выбор языка
- Сохранение изменений

### 6. Alarm Settings Modal
- Включение/выключение будильника
- Настройка времени
- Выбор звука

---

## Константы и конфигурации

### Константы в `constants.tsx`:

| Константа | Значение/Описание |
|-----------|-------------------|
| `BLOCK_CAPACITY` | 12 — максимальное количество очков на блок |
| `WEIGHT_CONFIG` | Конфигурация весов задач |
| `ALARM_SOUNDS[]` | Массив из 7 звуков природы |
| `RECOVERY_TIPS` | Советы по восстановлению (5 на язык) |
| `TRANSLATIONS` | Объект переводов UI |

---

## API интеграции

### Google Gemini AI

**Используемая модель:** `gemini-3-flash-preview`

**Функции:**
- `suggestWeight(title)` — классификация сложности задачи
- `optimizeTasks(tasks, periodLabel)` — оптимизация порядка задач

**API Key:** хранится в `process.env.GEMINI_API_KEY`

**Обработка ошибок:** Тихий fallback при отсутствии API key или ошибках

### Google Calendar

**Интеграция:** Открывает Google Calendar в новом окне с предзаполненными данными задачи

```javascript
calendar.google.com/calendar/render?action=TEMPLATE&text={title}&dates={dates}
```

### Dicebear API

**Использование:** Генерация аватаров пользователей

```
api.dicebear.com/7.x/avataaars/svg?seed={email}
```

---

## Поток данных (Data Flow)

```
User Input → State Update → localStorage Persistence
     ↓
Gemini AI (async) → Weight Suggestion → State Update
     ↓
Time Calculation → Active Period Detection → UI Rendering
```

---

## Вычисляемые значения

### Active Period Detection
Определяет текущий активный период на основе:
- Текущего времени
- `wakeUpTime`
- `restTime`
- Делит активное время на 3 равные части

### Wind Down Detection
Период за 90 минут до `restTime` с проверкой перехода через полночь.

### Recovery Mode
Активируется при:
- Текущий день в `recoveryDays`
- ИЛИ активен wind-down режим
- И НЕ является night silence

---

## Производительность

### Оптимизации:
- `memo()` для компонентов (`BackgroundSpots`, `TaskItem`)
- `useMemo` для вычисляемых значений (`isWindDown`, `activePeriodId`, `isRecoveryMode`, `dynamicBlocks`)
- `useCallback` для обработчиков событий
- Debounce (1 секунда) для AI запросов веса

### Хранение:
- localStorage для персистентности
- Реактивное обновление через useEffect

---

## Безопасность

### Замечания:
1. **Аутентификация симуляция** — нет реальной валидации credentials
2. **API Key** — хранится в переменных окружения, но не зашифрован
3. **localStorage** — данные хранятся локально без шифрования
4. **XSS** — используются `dangerouslySetInnerHTML` (не обнаружено, но стоит проверить)

---

## Потенциальные проблемы

1. **Отсутствие реального бэкенда**
   - Данные только в localStorage
   - Потеря данных при очистке браузера
   - Нет синхронизации между устройствами

2. **Ограниченная обработка ошибок**
   - Тихие fallbacks для AI запросов
   - Нет уведомлений пользователя об ошибках

3. **Неиспользуемый код**
   - Функция `optimizeTasks` описана, но не вызывается в UI

4. **Отсутствие валидации**
   - Минимальная валидация форм
   - Нет проверки длины задач

5. **Отсутствие тестов**
   - Нет unit тестов
   - Нет интеграционных тестов

---

## Возможности для улучшения

1. **Бэкенд**
   - Добавить реальную аутентификацию
   - Синхронизация данных между устройствами
   - Экспорт/импорт данных

2. **AI**
   - Использовать функцию `optimizeTasks` в UI
   - Добавить рекомендации по времени выполнения
   - Предсказание длительности задачи

3. **UX**
   - Добавить уведомления (toasts)
   - Drag & Drop для reorder задач
   - Шаблоны задач
   - Статистика продуктивности

4. **Технические улучшения**
   - Добавить unit тесты
   - E2E тесты
   - CI/CD pipeline
   - Error boundaries

5. **Доступность**
   - ARIA labels
   - Keyboard navigation
   - Screen reader support

---

## Статистика кода

| Метрика | Значение |
|---------|----------|
| Общие строки кода (App.tsx) | ~663 |
| Компоненты | 3 (App, Auth, TaskItem) |
| Сервисы | 1 (geminiService) |
| Типов TypeScript | ~9 интерфейсов/типов |
| Переводов | ~40 ключей на 3 языка |

---

## Заключение

**Flow Calendar** — это хорошо спроектированное приложение с интуитивным интерфейсом и продуманной системой time-blocking. Основные сильные стороны:

✅ Чистый архитектурный дизайн
✅ Использование современных технологий (React 19, TypeScript)
✅ Интеграция AI для автоматической классификации
✅ Мультиязычность
✅ Адаптивный дизайн

Области для развития:

⚠️ Добавление реального бэкенда
⚠️ Улучшение обработки ошибок
⚠️ Добавление тестирования
⚠️ Использование неиспользуемых AI-функций

Приложение готово для использования как личный планировщик задач с возможностью дальнейшего масштабирования.
